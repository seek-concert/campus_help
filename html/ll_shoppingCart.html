<!DOCTYPE HTML>
<head>
    <meta charset="UTF-8">
    <title>购物车</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
          content="width=device-width,height=device-height,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link rel="stylesheet" href="css/default.css"/>
    <link rel="stylesheet" href="css/ll_shoppingCart.css">
</head>
<body>
<!-- 代码部分begin -->
<div class="special">
    <div class="evaluate_title">
        <a href="#"><i class="iconfont iconfanhui"></i></a>
        <span>购物车</span>
    </div>
    <!-- 存在购物车数据 -->
    <div class="hasGoodsBox">
        <div class="allChose flex">
            <div class="checkboxWrap flex" style="line-height: .55rem">
                <input type="checkbox" class="e-selfecheckbox1 check_box check_box_all" id="allChose"
                       style="display: none">
                <label class="selfecheckbox_label1 check_box" for="allChose" style="display: none">全选</label>
                <span style="color: rgb(51,51,51);font-size: 0.4266rem;position: relative;"
                      class="shop_all_text">所有商品</span>
            </div>
            <div class="wancheng edit_shop">编辑</div>
            <div class="wancheng is_ok" style="display: none">完成</div>
        </div>
        <div class="my-address-list" id="my-address-list">
            <div id="cc-loading"><span></span>玩命加载中...</div>
        <div class="my-address-list">
            <div class="touch" id="touch1">
                <div class="item flex" userAddressId="1">
                    <div class="list flex">
                        <div class="checkboxWrap flex check_box" style="display:none">
                            <input type="checkbox" class="e-selfecheckbox1 checkoutBoxList"  id="listCheck1">
                            <label class="selfecheckbox_label1" for="listCheck1"></label>
                        </div>
                        <div class="goodsImg"><img src="./img/product_03.jpg" alt=""></div>
                        <div class="goodsInfo flex" style="width:7rem">
                            <div class="goodsInfoName">名称 1</div>
                            <div class="yuexiao"><span>月销123笔</span> <span>3kg|一米五</span></div>
                            <div class="flex price">
                                <div class="pri">￥ <span id="pri_1">25.00</span></div>
                                <input type="hidden" id="inputHid_1" value="25.00">
                                <div class="numberContent">
                                    <div class="jianDiv_" id="jianDiv_1" onclick="jian(this)">-</div>
                                    <div><input type="number" value="1" min="1" id="inputVale_1"
                                                style="width: 0.533rem"></div>
                                    <div id="jiaDiv_1" class="jiaDiv_" onclick="jia(this)">+</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <a href="javascript:;" class="remove">删除</a></div>
            </div>
        </div>
        <div class="my-address-list">
            <div class="touch" id="touch2">
                <div class="item flex" userAddressId="2">
                    <div class="list flex">
                        <div class="checkboxWrap flex check_box" style="display:none">
                            <input type="checkbox" class="e-selfecheckbox1 checkoutBoxList"  id="listCheck2">
                            <label class="selfecheckbox_label1" for="listCheck2"></label>
                        </div>
                        <div class="goodsImg"><img src="./img/product_03.jpg" alt=""></div>
                        <div class="goodsInfo flex" style="width:7rem">
                            <div class="goodsInfoName">名称 2</div>
                            <div class="yuexiao"><span>月销456笔</span> <span>3kg|一米五</span></div>
                            <div class="flex price">
                                <div class="pri">￥ <span id="pri_2">25.00</span></div>
                                <input type="hidden" id="inputHid_2" value="25.00">
                                <div class="numberContent">
                                    <div class="jianDiv_" id="jianDiv_2" onclick="jian(this)">-</div>
                                    <div><input type="number" value="1" min="1" id="inputVale_2"
                                                style="width: 0.533rem"></div>
                                    <div id="jiaDiv_2" class="jiaDiv_" onclick="jia(this)">+</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <a href="javascript:;" class="remove">删除</a></div>
            </div>
        </div>
    </div>

        <div class="SettlementWrap flex">
            <div class="checkboxWrap flex">
                <div class="flex"><span class="f_28 color_102">合计：</span><span class="f_24 color_ju">￥</span><span
                        class="f_32 color_ju all_price">0.00</span></div>
            </div>
            <div class="flex rightHeji">
                <div class="heji flex">
                    <div class="f_22 color_153">不含运费</div>
                </div>
                <div class="deleteBot jiesuan">结算</div>
            </div>
        </div>
        <div class="deleteWrap flex" style="display: none;">
            <div class="checkboxWrap flex">
                <div class="flex"><span class="f_28 color_102">共选中</span><span class="f_32 color_ju checked_num">0</span><span
                        class="f_28 color_102">件</span></div>
            </div>
            <div class="deleteBot">删除</div>
        </div>
    </div>
    <div class="noListData" style="display: none;">
        <div class="nodataLogBox">
            <div class="nodataLog"><i class="iconfont icongouwuche2"></i></div>
        </div>
        <div class="f_28 color_153">你的购物车还是空的赶紧行动吧！</div>
        <a class="goBuyBtn">马上去购物</a>
    </div>


</div>
<script src="./js/jquery-2.1.0.js"></script>
<script src="./js/fontSize.js"></script>
<script src="./js/jquery.mobile-1.3.2.min.js"></script>
<script>
    $(function () {
        document.getElementById('cc-loading').style.display = 'none';
        /* 左滑 右滑*/
        $(".item").on('touchstart', function (e) {
            startX = e.originalEvent.changedTouches[0].pageX,
                startY = e.originalEvent.changedTouches[0].pageY;
        });
        $(".item").on('touchend', function (e) {
            moveEndX = e.originalEvent.changedTouches[0].pageX,
                moveEndY = e.originalEvent.changedTouches[0].pageY,
                X = moveEndX - startX,
                Y = moveEndY - startY;
            if (X < -20) {
                console.log('左滑');
                $(this).addClass('selected').parents(".touch").siblings().find(".item").removeClass('selected');
            } else {
                $(this).parents(".touch").find(".item").removeClass('selected');
            }
        });

        //这是配合 jquery.mobile-1.3.2.min.js一起使用的
        $(".item").on("swipeleft", function () {
            $(this).addClass('selected').parents(".touch").siblings().find(".item").removeClass('selected');
            $(this).find("a.remove").on("click", function () {
                var touchId = $(this).parents(".touch").attr("id");
                //执行删除效果
                $("#" + touchId).css("border", "0");
                $("#" + touchId).stop().animate({
                    height: "0",
                    margin: "0"
                }, 300, function () {
                    $(this).remove();
                })
            })
        }).on("swiperight", function () {
            $(this).parents(".touch").find(".item").removeClass('selected');
        });

        //切换编辑状态
        $('.edit_shop').on('click', function () {
            $(this).hide();
            $('.is_ok').show();
            $('.check_box').css('display', 'block');
            $('.check_box_all').css('display', 'none');
            $('.shop_all_text').hide();
            $('.goodsInfo').attr('style', '');
            $('.SettlementWrap').attr('style', 'display:none');
            $('.deleteWrap').attr('style', '');
        });
        $('.is_ok').on('click', function () {
            $(this).hide();
            $('.edit_shop').show();
            $('.check_box').css('display', 'none');
            $('.shop_all_text').show();
            $('.goodsInfo').attr('style', 'width:7rem');
            $('.SettlementWrap').attr('style', '');
            $('.deleteWrap').attr('style', 'display:none');
        });

    });
    /* 计算价格 */
    var pri_length = $("[id^='pri_']").size();
    function js_price() {
        var pri = parseFloat('0.00');
        for(var i=1;i<=pri_length;i++){
            pri = parseFloat($('#pri_'+pri_length).text())+pri;
        }
        $('.all_price').text(pri);
    }
    js_price();
    $('.jiesuan').text('结算('+pri_length+')');
    //加
    function jia(obj) {
        var idStr = $(obj).attr("id").split('_');
        var numberVal = $("#inputVale_" + idStr[1]).val();
        numberVal++;
        $("#inputVale_" + idStr[1]).val(numberVal);
        var now_pri = Number($("#pri_" + idStr[1]).text()*numberVal);
        var all_pri_length = $("[id^='pri_']").size();

        var pri = 0;
        for(var i=1;i<=all_pri_length;i++){
            if(i!=idStr[1]){
                pri += accAdd(pri,$("#pri_"+i).text()*$("#inputVale_"+i).val());
            }
        }
        $('.all_price').text(pri+now_pri);
    }
    function accAdd(arg1, arg2) {
        arg1 = arg1.toString(), arg2 = arg2.toString();
        var arg1Arr = arg1.split("."), arg2Arr = arg2.split("."), d1 = arg1Arr.length == 2 ? arg1Arr[1] : "", d2 = arg2Arr.length == 2 ? arg2Arr[1] : "";
        var maxLen = Math.max(d1.length, d2.length);
        var m = Math.pow(10, maxLen);
        var result = Number(((arg1 * m + arg2 * m) / m).toFixed(maxLen));
        var d = arguments[2];
        return typeof d === "number" ? Number((result).toFixed(d)) : result;
    }

    //减
    function jian(obj) {
        var idStr = $(obj).attr("id").split('_');
        var numberVal = $("#inputVale_" + idStr[1]).val();
        if (numberVal <= 1) {
            return false;
        } else {
            numberVal--;
            // $("#pri_" + idStr[1]).text(Number($("#inputHid_" + idStr[1]).val() * numberVal));
        }
        $("#inputVale_" + idStr[1]).val(numberVal);
        $('.all_price').text($('.all_price').text()-$("#pri_" + idStr[1]).text());
    }
    //顶部全选
    $("#allChose").change(function(e){
        if($(this).prop('checked')){
            for(var i=0;i<$(".checkoutBoxList").length;i++){
                $("#my-address-list .checkoutBoxList").eq(i).prop('checked',true);
            }
            var all_checkbox_len = $("#my-address-list").find('.checkoutBoxList').length;
            $('.checked_num').text(all_checkbox_len);
        }else{
            for(var i=0;i<$(".checkoutBoxList").length;i++){
                $("#my-address-list .checkoutBoxList").eq(i).prop('checked',false);
            }
            $('.checked_num').text(0);
        }
    });
    //顶部全选冒泡
    $("#my-address-list").on('change','.checkoutBoxList',function(){
        if(!$(this).prop('checked')){
            $("#allChose").prop('checked',false);
        }
        var all_checkbox_len = $("#my-address-list").find('.checkoutBoxList').length;
        var is_checked_len = $("#my-address-list").find('input:checked').length;
       if(all_checkbox_len==is_checked_len){
           $("#allChose").prop('checked',true);
       }
       $('.checked_num').text(is_checked_len);
    })
</script>
<!-- 代码部分end -->
</body>
</html>
